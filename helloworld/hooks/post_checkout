#!/bin/bash
set -e

export DOCKER_CLI_EXPERIMENTAL="enabled"

echo "---------- DEBUG ----------"
echo "Docker version:"
docker run --rm \
  -e "DOCKER_CLI_EXPERIMENTAL=enabled" \
  -e "DOCKERCFG=${DOCKERCFG}" \
  -v /var/run/docker.sock:/var/run/docker.sock docker version

echo -e "\n"
echo "Environment variables:"
echo "DOCKER_REPO: ${DOCKER_REPO}"
echo "DOCKER_TAG: ${DOCKER_TAG}"
echo "DOCKER_CLI_EXPERIMENTAL: ${DOCKER_CLI_EXPERIMENTAL}"

docker manifest inspect xezpeleta/helloworld:latest

# downloads a local copy of qemu on docker-hub build machines
curl -L https://github.com/multiarch/qemu-user-static/releases/download/v3.0.0/qemu-arm-static -o qemu-arm-static

# Exec permission
chmod 755 qemu-arm-static